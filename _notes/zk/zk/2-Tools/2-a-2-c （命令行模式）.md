# Vim命令行模式

## Vim-Ex定义范围语法

| 符号            | 操作        |
| ------------- | --------- |
| :p(rint)      | 打印        |
| :d(elete)<br> | 删除        |
| :t            | 复制(到)<br> |
| :co(py)       | 与:t相同     |
| :m            | 移动        |

| 示例       | 用途                        |
| -------- | ------------------------- |
| :6t.     | 把第6行复制到当前行下方              |
| :t6      | 把当前行复制到第6行下方              |
| :t.      | 为当前行创建一个副本（类似于普通模式下的 yyp） |
| :t$      | 把当前行复制到文本结尾               |
| :'<,'>t0 | 把高亮选中的行复制到文件开头            |
| :'<,'>m$ | 把高亮选中的文本移到文件结尾            |

| 符号                   | 地址                                 | 示例                                 |
| -------------------- | ---------------------------------- | ---------------------------------- |
| :1                   | 文件第一行                              |                                    |
| :0                   | 虚拟行，位于文件第一行上方                      |                                    |
| :$                   | 文件最后一行                             |                                    |
| :.                   | 光标所在行                              |                                    |
| :%                   | 整个文件（:1,$ 的简写形式）                   |                                    |
| :{start},{end}<br>   | 指定从start行到end行的范围                  | :2,5                               |
| :/pattern/,/pattern/ | 用模式指定范围                            | :/import/,/return/p                |
| :{address}+n<br>     | {address} 可以是一个行 号、一个位置标记，或是一个查找模式 | :1,.+3p<br>:/import/+2,/return/-4p |
| :+                   | 等同于.+1                             |                                    |
| :-                   | 等同于.-1                             |                                    |
| 'm                   | 包含位置标记m的行                          |                                    |
| '<                   | 高亮选区的起始行                           | :'<,'>p                            |
| '>                   | 高亮选区的结束行                           |                                    |

> [!NOTE] 高亮选区会自动填充范围
> 用高亮选区(选择模式)选定一个范围后，如果按下 : 键，命令行上会预先填充一个范围 :'<,'>
> [用高亮选区指定命令行模式范围](../../../files/books/Tools/Vim.pdf#page=116&selection=75,0,75,9)

## Vim-Ex命令

| Ex命令                                           | 效果                               |
| ---------------------------------------------- | -------------------------------- |
| :[range]d(elete) [x]                           | 删除指定范围内的行[到寄存器x中]                |
| :[range]y(ank) [x]                             | 复制指定范围的行[到寄存器x中]                 |
| :[range]put [x]                                | 在指定行后粘贴寄存器x中的内容                  |
| :[range]t {address}                            | 把指定范围内的行拷贝到 {address} 指定的行之下     |
| :[range]m(ove) {address}                       | 把指定范围内的行移动到 {address} 指定的行之下     |
| :[range]j(oin)                                 | 连接指定范围内的行                        |
| :[range]normal {commands}                      | 对指定范围内的每一行执行普通模式命令 {commands}    |
| :[range]substitute/{pattern}/ {string}/[flags] | 对指定范围内的每一行执行替换命令                 |
| :[range]global/{pattern}/[cmd]                 | 对指定范围内匹配{pattern}的所有行执行Ex命令{cmd} |
| **@:**                                         | **重复执行上次的命令**                    |
| \<Tab>                                         | 自动补全                             |


> [!NOTE] 执行复数个命令
> '|' can be used to separate commands, so you can give multiple commands in one line.
> eg:`:g/V/t.|+d`
> 注意，过程中光标位置的变换会对通过｜进行的命令产生的结果造成影响，它们的执行是有先后顺序的。

## 与普通模式结合

| 命令             | 效果                      |
| -------------- | ----------------------- |
| :'<,'>normal . | 对高亮选区中的每一行执行普通模式下的 . 命令 |
| :%normal A;    | 在文件每一行的结尾都添加一个分号        |
| :%normal i//   | 注释整个文件                  |
| \<C-r>\<C-w>   | 复制光标下的单词并把它插入命令行中       |

:normal 命令让我们可以把具有强大表现力的 Vim 普通模式命令与具有大范围影响力的 Ex 命令结合在一起,珠联璧合！

> [!example] 
> [为选定行添加分号](../../../files/books/Tools/Vim.pdf#page=124&selection=32,0,33,6)

## 命令行窗口

| 命令  | 效果               |
| --- | ---------------- |
| q/  | 打开查找命令历史的命令行窗口   |
| q:  | 打开 Ex 命令历史的命令行窗口 |

> [!NOTE] 命令行窗口的操作
> 命令行窗口就像是一个常规的 Vim 缓冲区，只不过它的每行内容都对应着命令历史中的一个条目。可以用 k 及 j 键在历史中向前或向后移动，也可以用 Vim 的查找功能查找某一行。在按下 \<CR> 键时，其会把当前行的内容当成Ex命令加以执行。

## Vim与Shell

| 命令                | 效果                             |
| ----------------- | ------------------------------ |
| :!{cmd}           | 调用shell 中的命令                   |
| :read !{cmd}      | 在shell 中执行 {cmd},并把其标准输出插入光标下方 |
| :write !{cmd}<br> | 把缓冲区内容作为指定 {cmd} 的标准输入         |
| :write !sh<br>    | 在shell中执行当前缓冲区中的每行内容           |
| :[range]!{filter} | 使用外部程序 {filter} 过滤指定的 [range]  |

> [!NOTE] !{motion}直达命令行模式
> Vim 提供了一种方便的快捷方式来设置 :[range]!{filter} 命令中的范围。可以用 !{motion} 操作符切换到命令行模式，并把指定 {motion} 涵盖的范围预置在命令行上
> ```
> !G-->:.,$!
> !j -->:.,.+1!
> :[range]!{filter} --> :2,$!sort -t',' -k2
> ```

> [!warning]
> 如果你将感叹号错误地放在了write的后面：```:write! sh```
> 那么结果将会变为调用 :write! 命令把缓冲区内容写到一个名为 sh 的文件，这里的叹号会让Vim 覆盖任何已存的 sh 文件。
