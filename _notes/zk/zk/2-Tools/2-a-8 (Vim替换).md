# Vim替换

## 基本操作
> [!NOTE] :substitute
> :[range]s[ubstitute]/{pattern}/{string}/[flags]，其中[range]的语法可以从[Vim-Ex定义范围语法](2-Tools/2-a-2-c%20（命令行模式）.md#Vim-Ex定义范围语法)中学习。

| 替换域中的特殊字符        | 描述                                       |
| ---------------- | ---------------------------------------- |
| \r               | 插入一个换行符                                  |
| \t               | 插入一个制表符                                  |
| \\\              | 插入一个反斜杠                                  |
| \1               | 插入第1个子匹配                                 |
| \2               | 插入第2个子匹配（以此类推，最多到 \9）                    |
| \0               | 插入匹配模式的所有内容                              |
| &                | 插入匹配模式的所有内容                              |
| ~                | 使用上一次调用 :substitute时的 {string}           |
| \\={Vim script}  | 执行 {Vim Script} 表达式,并将返回的结果作为替换 {string} |
| g&               | 在整个文件的范围内重复上条替换命令                        |
| :{start},{end}&& | 在指定的范围内重复上条替换命令                          |

> [!NOTE] 标志位g
> g看似为 全局之意（global），实则有误导之嫌。也许有人想借此标志位在整个文件范围内进行替换操作，但实际上，它仅表示**当前一整行范围**。

> [!NOTE] 标志位c
> 引入标志位c后，Vim 会对每处匹配结果提示是否进行替换，可以按y键完成这次修改，或者按n键跳过这一次修改。所有操作请见[所有的选项](../../../files/books/Tools/Vim.pdf#page=338&selection=68,3,68,10)

> [!example]
> :%s/content/copy/gc
> %:在文件的每一行都执行此指令
> /g:当前一整行范围。
> /c:提示是否进行替换

## Vim替换方法论

> [!NOTE] 重用上次的查找模式
> 将substitute命令的查找域留空，意味着Vim将会重用上次的查找模式。所以我们执行substitute命令可以分成两个步骤：一是撰写查找模式，二是设计合适的替换字符串。
> ```
> :%s/\v'(([^']|'\w)+)'/"\1"/g等价于下面两条指令：
> /\v'(([^']|'\w)+)'
> :%s//"\1"/g
> ```
> 另外需要注意一点，把查找域留空，会在命令历史中留下一项不完整的记录。如果不想这样，只需在命令行中输入 \<C-r>/ `eg:(:%s/\<C-r>//"\1"/g)`， 即可把上次的查找内容粘贴进来。

> [!NOTE] 用寄存器的内容替换
> :s/\\=@{register1}/\\=@{register2}/g，即\\=@{register}的形式可以将寄存器的内容插入命令行。
> 同样，此方法也会在命令历史中留下一项不完整的记录。

> [!example]
> [在替换过程中执行算术运算](../../../files/books/Tools/Vim.pdf#page=352&selection=3,0,3,12)
> [交换两个或更多的单词](../../../files/books/Tools/Vim.pdf#page=354&selection=3,0,3,10)
> [在多个文件中执行查找与替换](../../../files/books/Tools/Vim.pdf#page=357&selection=3,0,3,13)